{% extends 'myapp/base.html' %}

<!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”»é¢ï¼šä»Šæ—¥ã®çŠ¶æ³ãƒ»AIææ¡ˆãƒ»è¡Œå‹•ãƒ»æ—¥è¨˜ãƒ»çµ±è¨ˆãƒ»ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ã‚’ã¾ã¨ã‚ã¦è¡¨ç¤º -->

{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - AIç¿’æ…£å½¢æˆã‚µãƒãƒ¼ã‚¿ãƒ¼{% endblock %}

{% block content %}
<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ä»Šæ—¥ã®æ—¥ä»˜ãªã©ï¼‰ -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-tachometer-alt me-2"></i>
        ä»Šæ—¥ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{% url 'myapp:diary_create' %}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>æ—¥è¨˜ã‚’æ›¸ã
            </a>
            <a href="{% url 'myapp:action_log_create' %}" class="btn btn-success">
                <i class="fas fa-plus me-1"></i>è¡Œå‹•ã‚’è¨˜éŒ²
            </a>
        </div>
    </div>
</div>

<!-- ä»Šæ—¥ã®æ—¥ä»˜è¡¨ç¤º -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center">
                <h3 class="card-title text-muted">
                    <i class="fas fa-calendar-day me-2"></i>
                    {{ today|date:"Yå¹´mæœˆdæ—¥ï¼ˆlï¼‰" }}
                </h3>
            </div>
        </div>
    </div>
</div>

<!-- ä»Šæ—¥ã®æ°—åˆ†ãƒ»ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»AIææ¡ˆãƒ»ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãªã© -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-heart me-2"></i>ä»Šæ—¥ã®æ°—åˆ†
            </div>
            <div class="card-body text-center">
                {% if today_diary %}
                    <div class="mood-score text-{% if today_diary.mood_score <= 3 %}danger{% elif today_diary.mood_score <= 7 %}warning{% else %}success{% endif %}">
                        {{ today_diary.mood_score }}/10
                    </div>
                    <p class="text-muted mt-2">
                        {% if today_diary.mood_score <= 3 %}
                            ğŸ˜¢ ä»Šæ—¥ã¯å°‘ã—è½ã¡è¾¼ã‚“ã§ã„ã¾ã™ã­
                        {% elif today_diary.mood_score <= 7 %}
                            ğŸ˜ æ™®é€šã®ä¸€æ—¥ã§ã—ãŸ
                        {% else %}
                            ğŸ˜Š ã¨ã¦ã‚‚è‰¯ã„æ°—åˆ†ã§ã™ã­ï¼
                        {% endif %}
                    </p>
                {% else %}
                    <div class="mood-score text-muted">--/10</div>
                    <p class="text-muted mt-2">ã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                    <a href="{% url 'myapp:diary_create' %}" class="btn btn-outline-primary btn-sm">
                        è¨˜éŒ²ã™ã‚‹
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-bolt me-2"></i>ä»Šæ—¥ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼
            </div>
            <div class="card-body text-center">
                {% if today_diary %}
                    <div class="energy-level text-{% if today_diary.energy_level <= 3 %}danger{% elif today_diary.energy_level <= 7 %}warning{% else %}success{% endif %}">
                        {{ today_diary.energy_level }}/10
                    </div>
                    <p class="text-muted mt-2">
                        {% if today_diary.energy_level <= 3 %}
                            ğŸ˜´ ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒä¸è¶³ã—ã¦ã„ã¾ã™
                        {% elif today_diary.energy_level <= 7 %}
                            ğŸ˜ æ™®é€šã®ã‚¨ãƒãƒ«ã‚®ãƒ¼é‡ã§ã™
                        {% else %}
                            âš¡ ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒæº€ã¡æº¢ã‚Œã¦ã„ã¾ã™ï¼
                        {% endif %}
                    </p>
                {% else %}
                    <div class="energy-level text-muted">--/10</div>
                    <p class="text-muted mt-2">ã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                    <a href="{% url 'myapp:diary_create' %}" class="btn btn-outline-primary btn-sm">
                        è¨˜éŒ²ã™ã‚‹
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- AIææ¡ˆ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card ai-recommendation">
            <div class="card-header bg-transparent text-white border-0">
                <i class="fas fa-robot me-2"></i>AIã‚³ãƒ¼ãƒã‹ã‚‰ã®ä»Šæ—¥ã®ææ¡ˆ
            </div>
            <div class="card-body">
                <h5 class="card-title text-white">{{ today_recommendation.title }}</h5>
                <p class="card-text text-white-75">{{ today_recommendation.content }}</p>
                
                {% if today_recommendation.action_items %}
                    <h6 class="text-white mt-3">å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š</h6>
                    <ul class="text-white-75">
                        {% for item in today_recommendation.action_items %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                
                <div class="mt-3">
                    <small class="text-white-50">
                        <i class="fas fa-info-circle me-1"></i>
                        ææ¡ˆç†ç”±: {{ today_recommendation.reasoning }}
                    </small>
                </div>
                
                <div class="mt-3">
                    <a href="{% url 'myapp:ai_recommendation_detail' today_recommendation.id %}" class="btn btn-light btn-sm">
                        <i class="fas fa-eye me-1"></i>è©³ç´°ã‚’è¦‹ã‚‹
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- é€±æ¬¡æŒ¯ã‚Šè¿”ã‚Šï¼ˆæ—¥æ›œæ—¥ã®å ´åˆï¼‰ -->
{% if weekly_reflection %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card motivational-card">
            <div class="card-header bg-transparent text-white border-0">
                <i class="fas fa-calendar-week me-2"></i>é€±æ¬¡æŒ¯ã‚Šè¿”ã‚Š
            </div>
            <div class="card-body">
                <h5 class="card-title text-white">{{ weekly_reflection.title }}</h5>
                <p class="card-text text-white-75">{{ weekly_reflection.content }}</p>
                
                {% if weekly_reflection.action_items %}
                    <h6 class="text-white mt-3">æ¥é€±ã«å‘ã‘ã¦ï¼š</h6>
                    <ul class="text-white-75">
                        {% for item in weekly_reflection.action_items %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                
                <div class="mt-3">
                    <a href="{% url 'myapp:ai_recommendation_detail' weekly_reflection.id %}" class="btn btn-light btn-sm">
                        <i class="fas fa-eye me-1"></i>è©³ç´°ã‚’è¦‹ã‚‹
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- æœ€è¿‘ã®è¡Œå‹•ãƒ­ã‚°ãƒ»æ—¥è¨˜ãƒ»çµ±è¨ˆã‚°ãƒ©ãƒ•ãªã© -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-list-check me-2"></i>ä»Šæ—¥ã®è¡Œå‹•</span>
                <a href="{% url 'myapp:action_log_create' %}" class="btn btn-primary btn-sm">
                    <i class="fas fa-plus me-1"></i>è¿½åŠ 
                </a>
            </div>
            <div class="card-body">
                {% if today_actions %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ã‚«ãƒ†ã‚´ãƒª</th>
                                    <th>è¡Œå‹•å</th>
                                    <th>æ™‚é–“</th>
                                    <th>å®Œäº†</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for action in today_actions %}
                                <tr>
                                    <td>
                                        <span class="badge" style="background-color: {{ action.category.color }};">
                                            {{ action.category.name }}
                                        </span>
                                    </td>
                                    <td>{{ action.action_name }}</td>
                                    <td>{{ action.duration_minutes }}åˆ†</td>
                                    <td>
                                        {% if action.completed %}
                                            <span class="badge bg-success">å®Œäº†</span>
                                        {% else %}
                                            <span class="badge bg-warning">æœªå®Œäº†</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'myapp:action_log_edit' action.id %}" class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                        <p class="text-muted">ä»Šæ—¥ã®è¡Œå‹•ã¯ã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                        <a href="{% url 'myapp:action_log_create' %}" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>æœ€åˆã®è¡Œå‹•ã‚’è¨˜éŒ²
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- æœ€è¿‘ã®æ°—åˆ†ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å‚¾å‘ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-line me-2"></i>æœ€è¿‘1é€±é–“ã®å‚¾å‘
            </div>
            <div class="card-body">
                <canvas id="trendChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥çµ±è¨ˆ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-pie me-2"></i>ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®è¡Œå‹•çµ±è¨ˆï¼ˆéå»1é€±é–“ï¼‰
            </div>
            <div class="card-body">
                {% if category_stats %}
                    <div class="row">
                        {% for stat in category_stats %}
                        <div class="col-md-4 mb-3">
                            <div class="card stats-card">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-white">{{ stat.category__name }}</h5>
                                    <div class="text-white-75">
                                        <p class="mb-1">ç·è¡Œå‹•æ•°: {{ stat.total_actions }}</p>
                                        <p class="mb-0">å®Œäº†æ•°: {{ stat.completed_actions }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <p class="text-muted">ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card motivational-card">
            <div class="card-body text-center">
                <h5 class="card-title text-white">
                    <i class="fas fa-quote-left me-2"></i>
                    ä»Šæ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                </h5>
                <p class="card-text text-white-75 fs-5">{{ motivational_message }}</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// æ°—åˆ†ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å‚¾å‘ãƒãƒ£ãƒ¼ãƒˆ
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('trendChart').getContext('2d');
    
    // ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
    const dates = [];
    const moodScores = [];
    const energyLevels = [];
    
    {% for diary in recent_diaries %}
        dates.push('{{ diary.date|date:"m/d" }}');
        moodScores.push({{ diary.mood_score }});
        energyLevels.push({{ diary.energy_level }});
    {% endfor %}
    
    if (dates.length > 0) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'æ°—åˆ†ã‚¹ã‚³ã‚¢',
                    data: moodScores,
                    borderColor: '#e74a3b',
                    backgroundColor: 'rgba(231, 74, 59, 0.1)',
                    tension: 0.4
                }, {
                    label: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¬ãƒ™ãƒ«',
                    data: energyLevels,
                    borderColor: '#f6c23e',
                    backgroundColor: 'rgba(246, 194, 62, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}
