{% extends 'myapp/base.html' %}

<!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÁîªÈù¢Ôºö‰ªäÊó•„ÅÆÁä∂Ê≥Å„ÉªAIÊèêÊ°à„ÉªË°åÂãï„ÉªÊó•Ë®ò„ÉªÁµ±Ë®à„Éª„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Á≠â„Çí„Åæ„Å®„ÇÅ„Å¶Ë°®Á§∫ -->

{% block title %}„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ - AIÁøíÊÖ£ÂΩ¢Êàê„Çµ„Éù„Éº„Çø„Éº{% endblock %}

{% block content %}
<!-- „Éò„ÉÉ„ÉÄ„ÉºÔºà„Éö„Éº„Ç∏„Çø„Ç§„Éà„É´„Éª‰ªäÊó•„ÅÆÊó•‰ªò„Å™„Å©Ôºâ -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-tachometer-alt me-2"></i>
        ‰ªäÊó•„ÅÆ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{% url 'myapp:diary_create' %}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Êó•Ë®ò„ÇíÊõ∏„Åè
            </a>
            <a href="{% url 'myapp:action_log_create' %}" class="btn btn-success">
                <i class="fas fa-plus me-1"></i>Ë°åÂãï„ÇíË®òÈå≤
            </a>
        </div>
    </div>
</div>

<!-- ‰ªäÊó•„ÅÆÊó•‰ªòË°®Á§∫ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center">
                <h3 class="card-title text-muted">
                    <i class="fas fa-calendar-day me-2"></i>
                    {{ today|date:"YÂπ¥mÊúàdÊó•ÔºàlÔºâ" }}
                </h3>
            </div>
        </div>
    </div>
</div>

<!-- ‰ªäÊó•„ÅÆÊ∞óÂàÜ„Éª„Ç®„Éç„É´„ÇÆ„Éº„ÉªAIÊèêÊ°à„Éª„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„Å™„Å© -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-heart me-2"></i>‰ªäÊó•„ÅÆÊ∞óÂàÜ
            </div>
            <div class="card-body text-center">
                {% if today_diary %}
                    <div class="mood-score text-{% if today_diary.mood_score <= 3 %}danger{% elif today_diary.mood_score <= 7 %}warning{% else %}success{% endif %}">
                        {{ today_diary.mood_score }}/10
                    </div>
                    <p class="text-muted mt-2">
                        {% if today_diary.mood_score <= 3 %}
                            üò¢ ‰ªäÊó•„ÅØÂ∞ë„ÅóËêΩ„Å°Ëæº„Çì„Åß„ÅÑ„Åæ„Åô„Å≠
                        {% elif today_diary.mood_score <= 7 %}
                            üòê ÊôÆÈÄö„ÅÆ‰∏ÄÊó•„Åß„Åó„Åü
                        {% else %}
                            üòä „Å®„Å¶„ÇÇËâØ„ÅÑÊ∞óÂàÜ„Åß„Åô„Å≠ÔºÅ
                        {% endif %}
                    </p>
                {% else %}
                    <div class="mood-score text-muted">--/10</div>
                    <p class="text-muted mt-2">„Åæ„Å†Ë®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                    <a href="{% url 'myapp:diary_create' %}" class="btn btn-outline-primary btn-sm">
                        Ë®òÈå≤„Åô„Çã
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-bolt me-2"></i>‰ªäÊó•„ÅÆ„Ç®„Éç„É´„ÇÆ„Éº
            </div>
            <div class="card-body text-center">
                {% if today_diary %}
                    <div class="energy-level text-{% if today_diary.energy_level <= 3 %}danger{% elif today_diary.energy_level <= 7 %}warning{% else %}success{% endif %}">
                        {{ today_diary.energy_level }}/10
                    </div>
                    <p class="text-muted mt-2">
                        {% if today_diary.energy_level <= 3 %}
                            üò¥ „Ç®„Éç„É´„ÇÆ„Éº„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô
                        {% elif today_diary.energy_level <= 7 %}
                            üòê ÊôÆÈÄö„ÅÆ„Ç®„Éç„É´„ÇÆ„ÉºÈáè„Åß„Åô
                        {% else %}
                            ‚ö° „Ç®„Éç„É´„ÇÆ„Éº„ÅåÊ∫Ä„Å°Ê∫¢„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ
                        {% endif %}
                    </p>
                {% else %}
                    <div class="energy-level text-muted">--/10</div>
                    <p class="text-muted mt-2">„Åæ„Å†Ë®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                    <a href="{% url 'myapp:diary_create' %}" class="btn btn-outline-primary btn-sm">
                        Ë®òÈå≤„Åô„Çã
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- AIÊèêÊ°à -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card ai-recommendation">
            <div class="card-header bg-transparent text-white border-0">
                <i class="fas fa-robot me-2"></i>AI„Ç≥„Éº„ÉÅ„Åã„Çâ„ÅÆ‰ªäÊó•„ÅÆÊèêÊ°à
            </div>
            <div class="card-body">
                <h5 class="card-title text-white">{{ today_recommendation.title }}</h5>
                <p class="card-text text-white-75">{{ today_recommendation.content }}</p>
                
                {% if today_recommendation.action_items %}
                    <h6 class="text-white mt-3">ÂÖ∑‰ΩìÁöÑ„Å™„Ç¢„ÇØ„Ç∑„Éß„É≥Ôºö</h6>
                    <ul class="text-white-75">
                        {% for item in today_recommendation.action_items %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                
                <div class="mt-3">
                    <small class="text-white-50">
                        <i class="fas fa-info-circle me-1"></i>
                        ÊèêÊ°àÁêÜÁî±: {{ today_recommendation.reasoning }}
                    </small>
                </div>
                
                <div class="mt-3">
                    <a href="{% url 'myapp:ai_recommendation_detail' today_recommendation.id %}" class="btn btn-light btn-sm">
                        <i class="fas fa-eye me-1"></i>Ë©≥Á¥∞„ÇíË¶ã„Çã
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ÈÄ±Ê¨°ÊåØ„ÇäËøî„ÇäÔºàÊó•ÊõúÊó•„ÅÆÂ†¥ÂêàÔºâ -->
{% if weekly_reflection %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card motivational-card">
            <div class="card-header bg-transparent text-white border-0">
                <i class="fas fa-calendar-week me-2"></i>ÈÄ±Ê¨°ÊåØ„ÇäËøî„Çä
            </div>
            <div class="card-body">
                <h5 class="card-title text-white">{{ weekly_reflection.title }}</h5>
                <p class="card-text text-white-75">{{ weekly_reflection.content }}</p>
                
                {% if weekly_reflection.action_items %}
                    <h6 class="text-white mt-3">Êù•ÈÄ±„Å´Âêë„Åë„Å¶Ôºö</h6>
                    <ul class="text-white-75">
                        {% for item in weekly_reflection.action_items %}
                            <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                
                <div class="mt-3">
                    <a href="{% url 'myapp:ai_recommendation_detail' weekly_reflection.id %}" class="btn btn-light btn-sm">
                        <i class="fas fa-eye me-1"></i>Ë©≥Á¥∞„ÇíË¶ã„Çã
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- ÊúÄËøë„ÅÆË°åÂãï„É≠„Ç∞„ÉªÊó•Ë®ò„ÉªÁµ±Ë®à„Ç∞„É©„Éï„Å™„Å© -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-list-check me-2"></i>‰ªäÊó•„ÅÆË°åÂãï</span>
                <a href="{% url 'myapp:action_log_create' %}" class="btn btn-primary btn-sm">
                    <i class="fas fa-plus me-1"></i>ËøΩÂä†
                </a>
            </div>
            <div class="card-body">
                {% if today_actions %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>„Ç´„ÉÜ„Ç¥„É™</th>
                                    <th>Ë°åÂãïÂêç</th>
                                    <th>ÊôÇÈñì</th>
                                    <th>ÂÆå‰∫Ü</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for action in today_actions %}
                                <tr>
                                    <td>
                                        <span class="badge" style="background-color: {{ action.category.color }};">
                                            {{ action.category.name }}
                                        </span>
                                    </td>
                                    <td>{{ action.action_name }}</td>
                                    <td>{{ action.duration_minutes }}ÂàÜ</td>
                                    <td>
                                        {% if action.completed %}
                                            <span class="badge bg-success">ÂÆå‰∫Ü</span>
                                        {% else %}
                                            <span class="badge bg-warning">Êú™ÂÆå‰∫Ü</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'myapp:action_log_edit' action.id %}" class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                        <p class="text-muted">‰ªäÊó•„ÅÆË°åÂãï„ÅØ„Åæ„Å†Ë®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>
                        <a href="{% url 'myapp:action_log_create' %}" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>ÊúÄÂàù„ÅÆË°åÂãï„ÇíË®òÈå≤
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ÊúÄËøë„ÅÆÊ∞óÂàÜ„Å®„Ç®„Éç„É´„ÇÆ„Éº„ÅÆÂÇæÂêë -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-line me-2"></i>ÊúÄËøë1ÈÄ±Èñì„ÅÆÂÇæÂêë
            </div>
            <div class="card-body">
                <canvas id="trendChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- „Ç´„ÉÜ„Ç¥„É™Âà•Áµ±Ë®à -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-pie me-2"></i>„Ç´„ÉÜ„Ç¥„É™Âà•„ÅÆË°åÂãïÁµ±Ë®àÔºàÈÅéÂéª1ÈÄ±ÈñìÔºâ
            </div>
            <div class="card-body">
                {% if category_stats %}
                    <div class="row">
                        {% for stat in category_stats %}
                        <div class="col-md-4 mb-3">
                            <div class="card stats-card">
                                <div class="card-body text-center">
                                    <h5 class="card-title text-white">{{ stat.category__name }}</h5>
                                    <div class="text-white-75">
                                        <p class="mb-1">Á∑èË°åÂãïÊï∞: {{ stat.total_actions }}</p>
                                        <p class="mb-0">ÂÆå‰∫ÜÊï∞: {{ stat.completed_actions }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <p class="text-muted">„Åæ„Å†„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- „É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„É°„ÉÉ„Çª„Éº„Ç∏ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card motivational-card">
            <div class="card-body text-center">
                <h5 class="card-title text-white">
                    <i class="fas fa-quote-left me-2"></i>
                    ‰ªäÊó•„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏
                </h5>
                <p class="card-text text-white-75 fs-5">{{ motivational_message }}</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Ê∞óÂàÜ„Å®„Ç®„Éç„É´„ÇÆ„Éº„ÅÆÂÇæÂêë„ÉÅ„É£„Éº„Éà
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('trendChart').getContext('2d');
    
    // „Éá„Éº„Çø„ÅÆÊ∫ñÂÇô
    const dates = [];
    const moodScores = [];
    const energyLevels = [];
    
    {% for diary in recent_diaries %}
        dates.push('{{ diary.date|date:"m/d" }}');
        moodScores.push({{ diary.mood_score }});
        energyLevels.push({{ diary.energy_level }});
    {% endfor %}
    
    if (dates.length > 0) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Ê∞óÂàÜ„Çπ„Ç≥„Ç¢',
                    data: moodScores,
                    borderColor: '#e74a3b',
                    backgroundColor: 'rgba(231, 74, 59, 0.1)',
                    tension: 0.4
                }, {
                    label: '„Ç®„Éç„É´„ÇÆ„Éº„É¨„Éô„É´',
                    data: energyLevels,
                    borderColor: '#f6c23e',
                    backgroundColor: 'rgba(246, 194, 62, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}
